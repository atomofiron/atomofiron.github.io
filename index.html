<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>

<style type="text/css">
html, body, video {
	padding: 0px;
	margin: 0px;
	background-color: #000000;
	overflow: hidden;
	font-family: arial;
}
* {
	box-sizing: content-box;
}
video {
    filter: brightness(0.8) contrast(2) hue-rotate(300deg);
}
canvas {
	width: 100%;
	background-color: #000000;
    margin-top: -4px;
    margin-bottom: -4px;
    image-rendering: optimizeSpeed;             /* Older versions of FF          */
    image-rendering: -moz-crisp-edges;          /* FF 6.0+                       */
    image-rendering: -webkit-optimize-contrast; /* Safari                        */
    image-rendering: -o-crisp-edges;            /* OS X & Windows Opera (12.02+) */
    image-rendering: pixelated;                 /* Awesome future-browsers       */
    -ms-interpolation-mode: nearest-neighbor;
}
#zero2 {
	text-align: center;
}
.layer {
	position: absolute;
	left: 0;
	right: 0;
	top: 0;
	margin: auto;
}
#avaRed, #avaGreen, #avaBlue {
	mix-blend-mode: exclusion;
}
#avaRgb {
	color: #0f0;
}
#start_button {
	width: 200px;
	height: 200px;
	background-color: #ff00ff;
	border-radius: 999px;
	position: absolute;
	left: 0;
	right: 0;
	top: 0;
	bottom: 0;
	margin: auto;
	padding: 64px;
	padding-top: 32px;
	color: black;
	text-align: center;
	cursor: pointer;
}
#content {
	display: none;
}
</style>
</head>
<body>


<div id="content">
	<div style="position: relative;">
		<center>
			<video style="visibility: hidden;" id="zero2" width="800" autoplay="" loop="" playsmuted="" muted="" [muted]="'muted'">
			    <source src="./new/02-5.mp4" type="video/mp4">
			</video>
		</center>
		<!-- <img id="avaRgb" style="transform: translate(400px, 0px);" class="layer" src="./new/me.png" width="440" /> -->
		<img id="avaRed" class="layer" src="./new/red.png" width="440"  />
		<img id="avaGreen" class="layer" src="./new/green.png" width="440"  />
		<img id="avaBlue" class="layer" src="./new/blue.png" width="440"  />

		<img style="position: absolute; left: 0; right: 0; bottom: 4px; margin: auto;" src="./new/mnts.png" width="1000"  />
	</div>

	<!-- <audio src="cut.mp3" controls></audio> -->

	<canvas id="canvas_ground" style="width: 100%;"></canvas>
</div>

<div id="start_button">
	<img src="./new/yeah.png">
	<b>НАЖМИ НА МЕНЯ<b><br><br>
</div>

<script type="text/javascript">

const clog = console.log
function get(id) {
	return document.getElementById(id)
}

const ground = document.getElementById("canvas_ground")
const ctx = ground.getContext("2d");

const lineWidthMin = 1
const lineWidthMax = 10
const hLineCount = 100
const vLineCount = 30
let hLineOffset = 0

const zeroTwo = get("zero2")

function drowVerticalLines(frameWidth, frameHeight) {
	ctx.lineCap = 'round'
	ctx.strokeStyle = "#ff00ff"

	const vOffset = 0
	const hStep = frameWidth / vLineCount

	const centerX = frameWidth / 2
	for (let x = hStep / 2; x < frameWidth - hStep / 2; x += hStep) {
		ctx.lineWidth = lineWidthMax * (1 - Math.abs(centerX - x) / centerX)
		ctx.beginPath()
		ctx.moveTo(x, 0)
		let dif = centerX - x
		dif *= Math.abs(dif) / hStep + 5
		ctx.lineTo(x - dif, frameHeight)
		ctx.stroke()
	}
}
let time = 0
function drowHorisontalLines() {
	ctx.lineWidth = 5
	const groundWidth = window.innerWidth * 2
	const groundHeight = window.innerHeight * 2

	for (let i = 0; i < hLineCount; i++) {
		let a = (i + 1) / hLineCount
		let y = Math.tan(time + (i + 1) * Math.PI / hLineCount) * 50 - 50
		y = y|0 + 0.5
		const lineWidth = lineWidthMax * (y / groundHeight) * 2
		ctx.lineWidth = Math.max(lineWidthMin, lineWidth)
	    ctx.beginPath()
		ctx.moveTo(0, y)
		ctx.lineTo(groundWidth, y)
		ctx.stroke()
	}
	time += Math.PI / 3000
	time %= Math.PI / 2
}
function drawGround() {
	const groundWidth = window.innerWidth * 2
	const groundHeight = window.innerHeight * 2

	ground.width = groundWidth
	ground.height = groundHeight

	drowVerticalLines(groundWidth, groundHeight)
	drowHorisontalLines()
}
setInterval(drawGround, 16)



const avaRed = get("avaRed")
const avaGreen = get("avaGreen")
const avaBlue = get("avaBlue")
const trembling = 5
let disappearance = 1 // 10
let maxTranslation = 20
let intensitySecuence = 0
let intensityStep = Math.PI / 30

let deviationRed = 0
let deviationGreen = 0
let deviationBlue = 0
let desortingInterval = 0
let oneWay = false

function startDisorting() {
	clearInterval(desortingInterval)
	intensitySecuence = 0
	const deviation = Math.PI * 2 * Math.random()
	deviationRed = deviation
	deviationGreen = deviationRed + Math.PI * 2 / 3
	deviationBlue = deviationRed + Math.PI * 4 / 3
	desortingInterval = setInterval(distortPicture, 16)
}
function distortPicture() {
	const r = oneWay ? Math.min(Math.PI / 2, intensitySecuence) : intensitySecuence
	const intensity = Math.sin(r)
	intensitySecuence += intensityStep
	if (intensitySecuence > Math.PI) {
		intensitySecuence = 0
		clearInterval(desortingInterval)
		avaRed.style.transform = ''
		avaGreen.style.transform = ''
		avaBlue.style.transform = ''
		if (oneWay) {
			avaRed.style.display = 'none'
			avaGreen.style.display = 'none'
			avaBlue.style.display = 'none'
			zeroTwo.style.visibility = 'visible'
		}
		return
	}
	distortLayer(avaRed, deviationRed, intensity)
	distortLayer(avaGreen, deviationGreen, intensity)
	distortLayer(avaBlue, deviationBlue, intensity)
}
function distortLayer(element, radian, intensity) {
	const dx = disappearance * (Math.random() > 0.5) ? trembling : -trembling
	const dy = disappearance * (Math.random() > 0.5) ? trembling : -trembling
	const x = (Math.cos(radian) * maxTranslation * disappearance + dx) * intensity
	const y = (Math.sin(radian) * maxTranslation * disappearance + dy) * intensity
	element.style.transform = `translate(${x}px, ${y}px)`
}

function hidePicture() {
	clearInterval(disortingStarterInterval)
	oneWay = true
	disappearance = 10
	intensitySecuence = 0
	startDisorting()
}
function showPicture() {
	oneWay = false
	disappearance = 1
	avaRed.style.display = 'block'
	avaGreen.style.display = 'block'
	avaBlue.style.display = 'block'
	zeroTwo.style.visibility = 'hidden'
	clearInterval(disortingStarterInterval)
	disortingStarterInterval = setInterval(startDisorting, 1800)
	startDisorting()
}


const audio = new Audio("./new/cut.mp3")
audio.volume = 1
audio.onended = function() {
	audio.play()
}
let disortingStarterInterval = 0
audio.onplay = function() {
	showPicture()
	setTimeout(hidePicture, 48000)
	setTimeout(showPicture, 79000)
	setTimeout(hidePicture, 127000)
	setTimeout(showPicture, 143000)
}
const startButton = get("start_button")
startButton.onclick = function() {
	audio.play()
	startButton.style.display = 'none'
	get("content").style.display = 'block'
}

</script>

</body>
</html>